{% extends 'main.html' %}
{% load static %}

{% block content %}
<div>

  <div>
    <h2>Gestion des structures</h2>
    <hr class="hrstructure">
  </div>

  <div class="features">
    <button class="structure-button"><a href="{% url 'create-structure' %}">Ajouter Structure</a></button>
    <button class="structure-button"><a href="{% url 'structure_history' %}">Historique</a></button>
  </div>

  <div class="page-content">
    <form id="search-form" class="search-container" action="{% url 'gestion_structure' %}">
      <input type="text" class="textbox" id="search-input" name="q" placeholder="Chercher...">
      <button type="submit" class="structure-button"><i><img src="{% static 'img/search.png' %}"></i></button>
      <img class="print" src="{% static 'img/print.png' %}" height="40px" width="40px" onclick="printTable()">
    </form>

    <div class="structure-table">
      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Type</th>
            <th>Libéllé</th>
            <th>Telephone</th>
            <th>Email</th>
            <th>Date de création</th>
            <th>Date AG</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for structure in structures %}
          <tr>
            <td><strong>{{ structure.code_structure }}</strong></td>
            <td>{{ structure.type }}</td>
            <td>{{ structure.libellé }}</td>
            <td>{{ structure.numéro_de_téléphone }}</td>
            <td>{{ structure.adresse_email }}</td>
            <td>{{ structure.date_de_création }}</td>
            <td>{{ structure.date_ag }}</td>
            <td>
              <button class="structure-button"><a href="{% url 'update-structure' structure.id %}">Mettre à jour</a></button>
              <button class="structure-button"><a href="{% url 'delete-structure' structure.id %}">Supprimer</a></button>
              <button class="structure-button"><a href="{% url 'consult_structure' structure.id %}">Consulter</a></button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
    function printTable() {
  // Hide unnecessary elements before printing
  const searchForm = document.getElementById('search-form');
  const printButton = document.getElementsByClassName('print')[0];

  // Save the original display styles of elements
  const originalStyles = {
    searchFormDisplay: searchForm.style.display,
    printButtonDisplay: printButton.style.display
  };

  // Hide elements before printing
  searchForm.style.display = 'none';
  printButton.style.display = 'none';

  // Hide the Actions column
  const actionColumn = document.querySelectorAll('.structure-table tbody td:last-child');
  for (let i = 0; i < actionColumn.length; i++) {
    actionColumn[i].style.display = 'none';
  }

  // Print the table content
  window.print();

  // Restore the original display styles and show the Actions column after printing
  searchForm.style.display = originalStyles.searchFormDisplay;
  printButton.style.display = originalStyles.printButtonDisplay;

  for (let i = 0; i < actionColumn.length; i++) {
    actionColumn[i].style.display = '';
  }
}
    document.getElementById('search-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const searchInput = document.getElementById('search-input').value.toLowerCase();
      const tableRows = document.querySelectorAll('.structure-table tbody tr');

      for (let i = 0; i < tableRows.length; i++) {
        const row = tableRows[i];
        const rowData = row.textContent.toLowerCase();

        if (rowData.includes(searchInput)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      }
    });
  </script>
</div>
{% endblock %}
